/*! jquery.uploader.js 2017-03-05 23:41:50*/
var UPLOADER_LANGUAGE={close:"\u5173\u95ed",drop_container:"\u62d6\u5230\u6587\u4ef6\u5230\u8fd9\u91cc",drop_tip:"\u652f\u6301\u4eceWindows\u4e2d\u62d6\u52a8\u6587\u4ef6\u5230\u8fd9\u91cc\u4e0a\u4f20\uff08\u9700\u73b0\u4ee3\u6d4f\u89c8\u5668\uff09",drop_button:"\u62d6\u653e\u6587\u4ef6",select_file:"\u9009\u62e9\u6587\u4ef6",ctrl_v_tip:"\u53ef\u4ee5\u4f7f\u7528Ctrl+V\u76f4\u63a5\u7c98\u8d34\u622a\u56fe\uff08\u9700\u73b0\u4ee3\u6d4f\u89c8\u5668\uff09",ctrl_v_button:"Ctrl+V \u7c98\u8d34",resize:"\u56fe\u7247\u4f1a\u81ea\u52a8\u7b49\u6bd4\u7f29\u653e\u81f3\uff1a{{0}} (\u4ec5jpg)",uploading:"\u6b63\u5728\u4e0a\u4f20\u6587\u4ef6...",success:"\u4e0a\u4f20\u6210\u529f!",rotate_right:"\u5411\u53f3\u65cb\u8f6c",rotate_left:"\u5411\u5de6\u65cb\u8f6c",loading:"\u6b63\u5728\u8f7d\u5165...",reading:"\u6587\u4ef6\u8bfb\u53d6\u4e2d...",filetype:"\u8bf7\u4e0a\u4f20{{0}}\u6587\u4ef6!",filenum_limite:"\u53ea\u5141\u8bb8\u4e0a\u4f20{{0}}\u4e2a\u6587\u4ef6\uff0c\u8bf7\u5220\u51cf\u540e\u91cd\u8bd5!",hashing:"\u6b63\u5728\u6548\u9a8c\u6587\u4ef6...",hash_success:"\u4e91\u7aef\u6587\u4ef6\u5df2\u5b58\u5728\uff0c\u6587\u4ef6\u79d2\u4f20\u6210\u529f!",error:"\u9519\u8bef",num_limit:"\u53ea\u80fd\u4e0a\u4f20{{0}}\u4e2a\u6587\u4ef6!",allsize_limit:"\u6587\u4ef6\u603b\u5927\u5c0f\u8d85\u51fa\u9650\u5236!",filesize_limite:"\u6587\u4ef6\u5927\u5c0f\u8d85\u51fa {{0}}!",duplicate:"\u4e0a\u4f20\u961f\u5217\u4e2d\u6709\u91cd\u590d\u6587\u4ef6!"};!function(e){if("undefined"==typeof LP)throw"this javascript file need behind 'laravel.lp.js'";e.fn.extend({uploader:function(i,t,a,r,s,l){var n={max_width:0,max_height:0,filesize:2097152,filetype:"jpg,jpeg,png,bmp,gif,webp,svg",filelimit:1,id:null};"object"==typeof i&&null!==i?n=e.extend({},n,i):i!==!0&&("undefined"!=typeof i&&(n.max_width=parseFloat(i)),"undefined"!=typeof t&&(n.max_height=parseFloat(t)),"undefined"!=typeof a&&(n.filesize=parseFloat(a)),"undefined"!=typeof r&&(n.filetype=r.toLowerCase()),"undefined"!=typeof s&&(n.filelimit=parseInt(s)),"undefined"!=typeof l&&(n.id=l));var o=["jpg","jpeg","png","bmp","gif","webp","svg"];return this.each(function(){var t=e(this),a=t.prop("flex_uploader")?t.prop("flex_uploader"):{};if(a&&a.uploader&&(delete a.uploader,a.$container.remove(),t.removeProp("flex_uploader")),i!==!0){var r={interval:null},s=function(){return rand(1e4,99999)},l=s(),d="uploader-id-"+l,u="pick-id-"+l,p=d+"-progresses",c=d+"-thumbnails";a.$container=e('<div class="uploader-container" id="'+d+'"><div class="pull-left"><div id="'+u+'">'+UPLOADER_LANGUAGE.select_file+"(\u2264 "+bytesToSize(n.filesize)+')</div></div><div class="pull-left tags">&nbsp;<span class="label label-success">.'+n.filetype.replace(/,/g,'</span>&nbsp;<span class="label label-success">.')+'</span>&nbsp;<span class="label label-warning enable-tooltip" data-placement="top" title="'+UPLOADER_LANGUAGE.drop_container+'"><small class="glyphicon glyphicon-info-sign"></small> '+UPLOADER_LANGUAGE.drop_button+"</span>"+(n.max_width>0&&n.max_height>0?"<br /><small>&nbsp;"+UPLOADER_LANGUAGE.resize.replace("{{0}}",n.max_width.toString().toHTML()+"x"+n.max_height.toString().toHTML())+"</small>":"")+'</div><div class="clearfix"></div><div id="'+p+'" class="progresses"></div><div class="clearfix"></div><div id="'+c+'" class="thumbnails row"></div><div class="clearfix"></div></div>').insertAfter(t),"undefined"!=typeof e.fn.tooltip&&e(".enable-tooltip",a.$container).tooltip();var f={},g=function(i){return f[i.id]||(f[i.id]=e('<div class="media alert alert-warning fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="media-left media-middle"><img class="media-object" src="" alt=""></div><div class="media-body"><h4 class="media-heading">'+i.name.toHTML()+"("+bytesToSize(i.size)+')</h4><div class="media-message"></div><div class="progress"><div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class=""></span></div></div></div></div>').appendTo("#"+p).on("closed.bs.alert",function(){"complete"==i.getStatus()?g(i).remove():g(i).cancel()})),{init:function(){return f[i.id].removeClass("alert-info alert-danger alert-success alert-warning"),this},initProgress:function(){e(".progress-bar",f[i.id]).removeClass("progress-bar-info progress-bar-danger progress-bar-success progress-bar-warning")},thumb:function(){a.uploader.makeThumb(i,function(t,a){e(".media-object",f[i.id]).attr("src",t?LP.baseuri+"placeholder?text="+i.ext+"&size=75x75&fontsize=35":a)})},name:function(t){return e(".progressName",f[i.id]).html(t.toHTML()),this},message:function(t){return e(".media-message",f[i.id]).html(t),this},error:function(t){return this.init(),this.initProgress(),i.setStatus("invalid"),f[i.id].addClass("alert-danger"),e(".progress-bar",f[i.id]).addClass("progress-bar-danger"),this.message(t)},progressing:function(t,a){this.init(),this.initProgress(),f[i.id].addClass("alert-info"),t=t.toFixed(2);var r=e(".progress-bar",f[i.id]).width(t+"%");return e(".progress-bar span",f[i.id]).text(t+"%"),t<20?r.addClass("progress-bar-warning"):t<95?r.addClass("progress-bar-info"):r.addClass("progress-bar-success"),t<100?r.addClass("active"):r.removeClass("active"),this.message(UPLOADER_LANGUAGE.uploading)},success:function(){return this.progressing(100),this.init(),f[i.id].addClass("alert-success"),f[i.id].delay(1500).queue(function(){e(this).alert("close").dequeue()}),this.message(UPLOADER_LANGUAGE.success)},cancel:function(){return a.uploader.cancelFile(i),this.remove()},remove:function(){return f[i.id].remove(),delete f[i.id],this}}},m={},h=function(i,r,s){if("undefined"!=typeof i&&"undefined"==typeof m[i])if(m[i]=e('<div class="col-xs-6 col-md-4 alert"><div class="thumbnail"><div class="file-panel"><span class="cancel" data-dismiss="alert" aria-label="Close">'+UPLOADER_LANGUAGE.close+'</span><span class="rotateRight">'+UPLOADER_LANGUAGE.rotate_right+'</span><span class="rotateLeft">'+UPLOADER_LANGUAGE.rotate_left+'</span></div><a href="'+LP.baseuri+"attachment/"+i+'"  target="_blank"><img src="'+LP.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(UPLOADER_LANGUAGE.loading)+'" alt="" class="img-responsive center-block"  onerror="this.src=\''+LP.baseuri+"placeholder?size=300x200&text='+encodeURIComponent('"+UPLOADER_LANGUAGE.reading+'\');"></a><div class="caption"><h4><span class="title">'+(r?r.toHTML():"")+'</span><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></h4></div><div class="clearfix"></div></div><div class="clearfix"></div></div>').appendTo("#"+c).on("closed.bs.alert",function(){h(i).remove()}),e(".rotateLeft,.rotateRight",m[i]).on("click",function(){var t=parseInt(m[i].data("rotation"))||0;t+=e(this).is(".rotateLeft")?-90:90,deg="rotate("+t+"deg)",e("img",m[i]).css(e.supportTransition?{"-webkit-transform":deg,"-mos-transform":deg,"-o-transform":deg,transform:deg}:{filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(t/90%4+4)%4+")"}),m[i].data("rotation",t)}),s){var l=o.indexOf(s.toLowerCase())>-1?LP.baseuri+"attachment/preview/"+i:LP.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(s);e("img",m[i]).attr("src",l)}else LP.get(LP.baseuri+"api/attachment/"+i).done(function(t){if("undefined"!=typeof t.data.ext){var a=o.indexOf(t.data.ext.toLowerCase())>-1?LP.baseuri+"attachment/preview/"+i:LP.baseuri+"placeholder?size=300x200&text="+encodeURIComponent(t.data.ext);e(".title",m[i]).text(t.data.filename),e("img",m[i]).attr("src",a)}});return{build:function(){return t.triggerHandler("uploader.previewing",[this.getFile(),i,v().get()])===!1?this:(v().add(i),t.triggerHandler("uploader.previewed",[this.getFile(),i,v().get()]),this)},remove:function(){var e=this.getFile();return t.triggerHandler("uploader.removing",[e,i,v().get()])===!1?this:(e&&a.uploader.removeFile(e,!0),v().remove(i),m[i].remove(),delete m[i],t.triggerHandler("uploader.removed",[e,i,v().get()]),this)},setFile:function(e){return m[i].data("file",e),this},getFile:function(){return m[i].data("file")},removeAll:function(){for(var e in m)h(e).remove()},rebuildAll:function(){files=a.uploader.getFiles();for(var e=0;e<files.length;e++)a.uploader.removeFile(files[e],!0);this.removeAll();var i=v().get();for(e=0;e<i.length;e++)h(i[e]).build();return this}}},v=function(){var e=t.val();return"0"==e&&(e=""),aids=e?e instanceof Array?e:e.split(","):[],{write:function(){return t.is("select")&&(t.empty(),aids.forEach(function(e){t.append('<option value="'+e+'">'+e+"</option>")})),t.val(aids),this},add:function(e){1==n.filelimit&&(aids=[e.toString()]);var i=aids.indexOf(e.toString());return i==-1&&aids.push(e.toString()),this.write()},remove:function(e){var i=aids.indexOf(e.toString());return i!=-1&&aids.splice(i,1),this.write()},removeAll:function(){return aids=[],this.write()},get:function(){return aids}}};r.beforeFileQueued=function(i){return n.filetype.split(",").indexOf(i.ext.toLowerCase())==-1?(e.alert(UPLOADER_LANGUAGE.filetype.replace("{{0}}",n.filetype)),!1):!(n.filelimit>1&&v().get().length>=n.filelimit)||(e.alert(UPLOADER_LANGUAGE.filenum_limite.replace("{{0}}",n.filelimit)),!1)},r.fileQueued=function(e){return t.triggerHandler("uploader.uploading",[e,v().get()])!==!1&&(g(e).init().thumb(),n.max_width>0&&n.max_height>0&&("jpg"==e.ext||"jpeg"==e.ext)?(a.uploader.upload(e),!0):(this.md5File(e).progress(function(i){g(e).progressing(0).message(UPLOADER_LANGUAGE.hashing+" "+(100*i).toFixed(2)+"%")}).then(function(i){LP.PUT(LP.baseuri+"attachment/hash",{hash:i,_token:LP.csrf,filename:e.name,ext:e.ext,size:e.size}).done(function(i){a.uploader.skipFile(e),g(e).success().message(UPLOADER_LANGUAGE.hash_success),1==n.filelimit&&h().removeAll(),h(i.data.id,i.data.filename,i.data.ext).build().setFile(e),t.triggerHandler("uploader.uploaded",[e,i,v().get()])}).fail(function(){e.md5=i,a.uploader.upload(e)})}),!0))},r.uploadBeforeSend=function(e,i,t){i.uuid=e.blob.ruid+e.file.id+e.file.size,i.start=e.start,i.end=e.end,i.chunks=e.chunks,i.chunk=e.chunk,i.total=e.file.size,i.hash=e.file.md5},r.uploadStart=function(e){},r.uploadProgress=function(e,i){t.triggerHandler("uploader.progressing",[e,100*i,v().get()]),g(e).progressing(100*i)},r.uploadSuccess=function(e,i){var a=i.message&&i.message.content?i.message.content:i.message;!i||"success"!=i.result&&"api"!=i.result?(g(e).error(UPLOADER_LANGUAGE.error+": "+a),t.triggerHandler("uploader.error",[e,a,v().get()])):(g(e).success(),1==n.filelimit&&h().removeAll(),h(i.data.id,i.data.filename,i.data.ext).build().setFile(e),t.triggerHandler("uploader.uploaded",[e,i,v().get()]))},r.uploadError=function(e,i){g(e).error(UPLOADER_LANGUAGE.error+": "+i),t.triggerHandler("uploader.error",[e,i,v().get()])},r.uploadComplete=function(e){},r.error=function(i,t,a){switch(i){case"Q_EXCEED_NUM_LIMIT":e.alert(UPLOADER_LANGUAGE.num_limit.replace("{{0}}",t));break;case"Q_EXCEED_SIZE_LIMIT":e.alert(UPLOADER_LANGUAGE.allsize_limit);break;case"F_EXCEED_SIZE":e.alert(UPLOADER_LANGUAGE.filesize_limite.replace("{{0}}",bytesToSize(n.filesize)));break;case"F_DUPLICATE":e.alert(UPLOADER_LANGUAGE.duplicate);break;case"Q_TYPE_DENIED":e.alert(UPLOADER_LANGUAGE.filetype.replace("{{0}}",n.filetype));break;default:e.alert(i)}},r.create=function(){a.uploader||"undefined"==typeof t.prop("flex_uploader")||"undefined"!=typeof t.prop("flex_uploader").uploader||(a.uploader=WebUploader.create({swf:LP.baseuri+"static/js/webuploader/Uploader.swf",server:LP.baseuri+"attachment/uploader?of=json",pick:{id:document.getElementById(u),multiple:!0},formData:e.extend(!0,{},{_token:LP.csrf}),fileVal:"Filedata",method:"POST",sendAsBinary:!1,fileNumLimit:0,fileSingleSizeLimit:n.filesize,duplicate:!1,accept:{title:UPLOADER_LANGUAGE.select_file,extensions:n.filetype,mimeTypes:"undefined"==typeof mimeType||navigator.userAgent.indexOf("Chrome")?"*/*":n.filetype.split(",").map(function(e){return mimeType.lookup("name."+e)}).join(",")},prepareNextFile:!0,chunkSize:5242880,chunkRetry:5,chunked:!0,threads:3,thumb:{width:75,height:75,quality:70,allowMagnify:!1,crop:!0},resize:!1,compress:null}),n.max_width>0&&n.max_height>0&&a.uploader.option("compress",{width:n.max_width,height:n.max_height,quality:100,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!0,compressSize:0}),a.uploader.on("beforeFileQueued",r.beforeFileQueued),a.uploader.on("fileQueued",r.fileQueued),a.uploader.on("uploadBeforeSend",r.uploadBeforeSend),a.uploader.on("uploadStart",r.uploadStart),a.uploader.on("uploadProgress",r.uploadProgress),a.uploader.on("uploadSuccess",r.uploadSuccess),a.uploader.on("uploadError",r.uploadError),a.uploader.on("uploadComplete",r.uploadComplete),a.uploader.on("error",r.error),t.prop("flex_uploader",a),n.id&&v().add(n.id),h().rebuildAll())},t.prop("flex_uploader",a),a.$container.is(":visible")?r.create():r.interval=setInterval(function(){a.$container.is(":visible")&&(clearInterval(r.interval),r.create())},500)}})}})}(jQuery);
//# sourceMappingURL=jquery.uploader.min.js.map
