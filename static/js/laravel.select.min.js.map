{"version":3,"sources":["laravel.select.js"],"names":["$","ready","method","cacheData","getData","url","params","key","JSON","stringify","$dfd","jQuery","Deferred","resolve","POST","done","json","textStatus","jqXHR","result","items","data","args","arguments","reject","apply","fail","promise","replaceData","format","replace","$0","$1","id","text","pid","i","length","d","children","push","recursive","prefix","v","_class","selection","ds","j","each","$this","this","value","attr","baseuri","extend","all","select2","language","allowClear","val","split","trigger","tree","templateResult","templateSelection","term","filters","_config","ajax","dataType","type","delay","page","_token","crsf","like","processResults","results","cache","escapeMarkup","markup","minimumInputLength","filters[id][in]","appendTo","fn","tags","keywords","count","createTag","trim","newTag"],"mappings":"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","file":"laravel.select.min.js","sourcesContent":["(function($){\r\n$().ready(function(){\r\n\tvar method = {cacheData: {}};\r\n\tmethod.getData = function(url, params) {\r\n\t\tvar key = JSON.stringify({url: url, params: params});\r\n\t\tvar $dfd = jQuery.Deferred();\r\n\r\n\t\tif (typeof method.cacheData[key] != 'undefined')\r\n\t\t\t$dfd.resolve(method.cacheData[key]);\r\n\t\telse {\r\n\t\t\t$.POST(url, params).done(function(json, textStatus, jqXHR){\r\n\t\t\t\tif (json.result == 'success' || json.result == 'api') {\r\n\t\t\t\t\tvar items = json.data.data;\r\n\t\t\t\t\tmethod.cacheData[key] = items;\r\n\t\t\t\t\t$dfd.resolve(method.cacheData[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar args = arguments;\r\n\t\t\t\t\t$dfd.reject.apply($dfd, args);\r\n\t\t\t\t}\r\n\t\t\t}).fail(function(){\r\n\t\t\t\tvar args = arguments;\r\n\t\t\t\t$dfd.reject.apply($dfd, args);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn $dfd.promise();\r\n\t};\r\n\tmethod.replaceData = function(data, format)\r\n\t{\r\n\t\treturn format.replace(/\\{([\\w]+)\\}/g, function($0, $1){\r\n\t\t\treturn data[$1];\r\n\t\t});\r\n\t};\r\n\tmethod.format = function(items, id, text, pid) {\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < items.length; ++i) {\r\n\t\t\tvar d = {\r\n\t\t\t\t'id': id ? method.replaceData(items[i], id) : items[i].id, \r\n\t\t\t\t'text': text ? method.replaceData(items[i], text) : items[i].text,\r\n\t\t\t\t'pid': pid ? method.replaceData(items[i], pid) : items[i].pid\r\n\t\t\t};\r\n\t\t\tif (typeof items[i].children == 'object' && typeof items[i].children.length != 'undefined')\r\n\t\t\t\td.children = method.format(items[i].children, id, text);\r\n\t\t\tresult.push(d);\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tmethod.recursive = function(items, prefix) {\r\n\t\tprefix = typeof prefix == 'undefined' ? '' : prefix;\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < items.length; ++i) {\r\n\t\t\tvar v = items[i];\r\n\t\t\tvar _class = 'treeline ';\r\n\t\t\tif (i === 0 && !prefix) //首节点\r\n\t\t\t\t_class += 'top-';\r\n\t\t\telse if (i == items.length - 1) //尾节点\r\n\t\t\t\t_class += 'bottom-';\r\n\t\t\telse\r\n\t\t\t\t_class += 'center-';\r\n\t\t\t_class += v.children ? 'open' : 'line';\r\n\r\n\t\t\tvar d = {\r\n\t\t\t\t'id': v.id,\r\n\t\t\t\t'selection': v.text,\r\n\t\t\t\t'text': prefix + '<span class=\"'+_class+'\"></span>' + v.text\r\n\t\t\t};\r\n\t\t\tresult.push(d);\r\n\t\t\tif (v.children)\r\n\t\t\t{\r\n\t\t\t\tvar ds = method.recursive(v.children, prefix + (i == items.length - 1 ? '<span class=\"treeline blank\"></span>' : '<span class=\"treeline blank-line\"></span>'));\r\n\t\t\t\tfor(var j = 0; j < ds.length; ++j)\r\n\t\t\t\t\tresult.push(ds[j]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\t$('.select-model').each(function(){\r\n\t\tvar $this = $(this);\r\n\t\tvar id = $this.data('id');\r\n\t\tvar text = $this.data('text');\r\n\t\tvar params = $this.data('params');\r\n\t\tvar value = $this.attr('value');\r\n\t\tvar url = $.baseuri + $this.data('model')+'/data/json';\r\n\t\tparams = $.extend({}, {all: 'true'}, params);\r\n\t\tmethod.getData(url, params).done(function(json){\r\n\t\t\tvar data = method.format(json, id, text); \r\n\t\t\t$this.select2({language: \"zh-CN\", data: data, allowClear: true});\r\n\t\t\t$this.val(value ? value.split(',') : null).trigger(\"change\");\r\n\t\t});\r\n\t});\r\n\t$('.tree-model').each(function(){\r\n\t\tvar $this = $(this);\r\n\t\tvar id = $this.data('id');\r\n\t\tvar pid = $this.data('pid');\r\n\t\tvar text = $this.data('text');\r\n\t\tvar params = $this.data('params');\r\n\t\tvar value = $this.attr('value');\r\n\t\tvar url = $.baseuri + $this.data('model')+'/data/json';\r\n\t\tparams = $.extend({}, {all: 'true', tree: 'true'}, params);\r\n\r\n\t\tmethod.getData(url, params).done(function(json){\r\n\t\t\tvar data = method.format(json, id, text, pid);\r\n\t\t\tdata = method.recursive(data);\r\n\t\t\t$this.select2({\r\n\t\t\t\t//theme: \"bootstrap\",\r\n\t\t\t\tlanguage: \"zh-CN\",data: data, allowClear: true,\r\n\t\t\t\ttemplateResult: function(data){return $('<div>' + data.text + '</div>');},\r\n      \t\t\ttemplateSelection: function(data){return data.selection;}\r\n\t\t\t});\r\n\t\t\t$this.val(value ? value.split(',') : null).trigger(\"change\");\r\n\t\t});\r\n\t});\r\n\t$('.suggest-model').each(function(){\r\n\t\tvar $this = $(this);\r\n\t\tvar id = $this.data('id');\r\n\t\tvar text = $this.data('text');\r\n\t\tvar selection = $this.data('selection') ? $this.data('selection') : text;\r\n\r\n\t\tvar term = $this.data('term');\r\n\t\tvar filters = $this.data('filters');\r\n\t\tvar value = $this.attr('value');\r\n\r\n\t\tvar _config = {\r\n\t\t\tlanguage: \"zh-CN\",\r\n\t\t\tajax: {\r\n\t\t\t\turl: $.baseuri + $this.data('model')+'/data/json',\r\n\t\t\t\tdataType: 'json',\r\n\t\t\t\ttype: 'post',\r\n\t\t\t\tdelay: 250,\r\n\t\t\t\tdata: function (params) {\r\n\t\t\t\t\tvar v = {page: params.page, _token: $.crsf, filters: {}};\r\n\t\t\t\t\tv.filters[term] = {'like': params.term};\r\n\t\t\t\t\tv.filters = $.extend({}, v.filters, filters);\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t},\r\n\t\t\t\tprocessResults: function (json, page) {\r\n\t\t\t\t\tif (json.result != 'success' && json.result != 'api') return {result: []};\r\n\t\t\t\t\tvar data = [], items = json.data.data;\r\n\t\t\t\t\tfor(var i = 0; i < items.length; ++i)\r\n\t\t\t\t\t\tdata.push({'id': id ? method.replaceData(items[i], id) : items[i].id, 'text': text ? method.replaceData(items[i], text) : items[i].text, 'selection': selection ? method.replaceData(items[i], selection) : items[i].selection});\r\n\t\t\t\t\treturn {results: data};\r\n\t\t\t\t},\r\n\t\t\t\tcache: true\r\n\t\t\t},\r\n\t\t\tescapeMarkup: function (markup) {return markup;},\r\n\t\t\tminimumInputLength: 1,\r\n\t\t\tallowClear: true,\r\n\t\t\ttemplateResult: function(data){return data.text;},\r\n\t\t\ttemplateSelection: function(data){return data.selection || data.text;}\r\n\t\t};\r\n\t\tif (value) {\r\n\t\t\t$.POST($.baseuri + $this.data('model')+'/data/json', {'filters[id][in]': value.split(',')}, function(json){\r\n\t\t\t\tif (json.result == 'success' || json.result == 'api') {\r\n\t\t\t\t\tvar items = json.data.data;\r\n\t\t\t\t\tfor(var i = 0; i < items.length; ++i)\r\n\t\t\t\t\t\t$('<option value=\"'+(id ? method.replaceData(items[i], id) : items[i].id)+'\" selected=\"selected\">'+(text ? method.replaceData(items[i], text) : items[i].text)+'</option>').appendTo($this);\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t$this.select2(_config);\r\n\t\t\t}, false);\r\n\t\t} else\r\n\t\t\t$this.select2(_config);\r\n\t});\r\n\t$.fn.extend({tags: function(filters){\r\n\t\treturn this.each(function(){\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar _config = {\r\n\t\t\t\tlanguage: \"zh-CN\",\r\n\t\t\t\tajax: {\r\n\t\t\t\t\turl: $.baseuri +'admin/tag/data/json',\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\ttype: 'post',\r\n\t\t\t\t\tdelay: 250,\r\n\t\t\t\t\tdata: function (params) {\r\n\t\t\t\t\t\tvar v = {page: params.page, _token: $.crsf, filters: {}};\r\n\t\t\t\t\t\tv.filters.keywords = {'like': params.term};\r\n\t\t\t\t\t\tv.filters = $.extend({}, v.filters, filters);\r\n\t\t\t\t\t\treturn v;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tprocessResults: function (json, page) {\r\n\t\t\t\t\t\tif (json.result != 'success' && json.result != 'api') return {result: []};\r\n\t\t\t\t\t\tvar data = [], items = json.data.data;\r\n\t\t\t\t\t\tfor(var i = 0; i < items.length; ++i)\r\n\t\t\t\t\t\t\tdata.push({'id': items[i].keywords, 'text': items[i].keywords + ' <span class=\"text-muted\">('+ (items[i].count || 0) + '次使用)</span>', 'selection': items[i].keywords });\r\n\t\t\t\t\t\treturn {results: data};\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcache: true\r\n\t\t\t\t},\r\n\t\t\t\tescapeMarkup: function (markup) {return markup;},\r\n\t\t\t\tminimumInputLength: 1,\r\n\t\t\t\ttemplateResult: function(data){return data.text;},\r\n\t\t\t\ttemplateSelection: function(data){return data.selection || data.text;},\r\n\t\t\t\tcreateTag: function (params) {\r\n\t\t\t\t\tvar term = $.trim(params.term);\r\n\t\t\t\t\tif (term === '') return null;\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid: term,\r\n\t\t\t\t\t\tselection: term,\r\n\t\t\t\t\t\ttext: term + ' <span style=\"color:#f5f5f5\">(创建)</span>',\r\n\t\t\t\t\t\tnewTag: true // add additional parameters\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t$this.select2($.extend({tags: true}, _config));\r\n\t\t});\r\n\t}});\r\n});\r\n})(jQuery);"]}